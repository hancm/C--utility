TDBANKCPP_PATH := $(PWD)/build/
TARGET_PATH := $(PWD)/../../build/

LIB_PATH := $(PWD)/podofo-0.9.6
INSTALL_PREFIX := $(TDBANKCPP_PATH)
CONDA_LIB := /opt/anaconda3/envs/sealserver/

all:
	mkdir -p $(INSTALL_PREFIX) && cd $(INSTALL_PREFIX) && cmake -G "Unix Makefiles" \
	-DCMAKE_CXX_FLAGS="-g -O3" -DCMAKE_BUILD_TYPE=Release \
	-DPODOFO_BUILD_STATIC:BOOL=FALSE -DPODOFO_BUILD_LIB_ONLY:BOOL=TRUE \
	-DPODOFO_BUILD_SHARED:BOOL=TURE -DWANT_LIB64:BOOL=TRUE \
	-DPODOFO_MULTI_THREAD=TRUE -DUSE_STLPORT=FALSE \
	-DUNISTRING_INCLUDE_DIR=$(TARGET_PATH)/include/unistring -DUNISTRING_LIBRARY=$(TARGET_PATH)/lib \
	-DLIBIDN_INCLUDE_DIR=$(TARGET_PATH)/include/idn/ -DLIBIDN_LIBRARIES=$(TARGET_PATH)/lib \
	-DFREETYPE_INCLUDE_DIR=$(CONDA_LIB)/include/freetype2 -DFREETYPE_LIBRARIES=$(CONDA_LIB)/lib/ \
	-DLIBCRYPTO_INCLUDE_DIR=$(CONDA_LIB)/include/openssl -DLIBCRYPTO_LIBRARIES=$(CONDA_LIB)/lib/ \
	-DZLIB_INCLUDE_DIR=$(CONDA_LIB)/include -DZLIB_LIBRARIES=$(CONDA_LIB)/lib/ \
	-DOPENSSL_INCLUDE_DIR=$(CONDA_LIB)/include/openssl -DOPENSSL_LIBRARIES=$(CONDA_LIB)/lib/ \
	-DLIBJPEG_INCLUDE_DIR=$(CONDA_LIB)/include -DLIBJPEG_LIBRARIES=$(CONDA_LIB)/lib/ \
	-DPNG_INCLUDE_DIR=$(CONDA_LIB)/include -DPNG_LIBRARIES=$(CONDA_LIB)/lib/ \
	-DTIFF_INCLUDE_DIR=$(CONDA_LIB)/include -DTIFF_LIBRARIES=$(CONDA_LIB)/lib/ \
	-DCMAKE_INSTALL_PREFIX=$(INSTALL_PREFIX) $(LIB_PATH) && make && make install

install:
	cp -rf $(INSTALL_PREFIX)/include/* $(TARGET_PATH)/include 
	cp -rf $(INSTALL_PREFIX)/podofo_config.h $(TARGET_PATH)/include/podofo/ 
	cp -rf $(INSTALL_PREFIX)/lib64/*.so* $(TARGET_PATH)/lib

clean:
	rm -rf $(INSTALL_PREFIX)

.PHONY: all install clean
